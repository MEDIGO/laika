machine:
    pre:
        - sudo curl -L -o /usr/bin/docker 'https://s3-external-1.amazonaws.com/circle-downloads/docker-1.9.1-circleci'
        - sudo chmod 0755 /usr/bin/docker
    services:
        - docker
    environment:
      GO15VENDOREXPERIMENT: 1
      BASE_DIR: $HOME/.go_project/src/github.com/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME
      LAIKA_MYSQL_USERNAME: ubuntu
      LAIKA_MYSQL_HOST: localhost
      LAIKA_MYSQL_PORT: 3306
      LAIKA_MYSQL_DBNAME: circle_test

general:
  build_dir:
    ../../../$BASE_DIR

dependencies:
    override:
        - mkdir -p $(dirname $BASE_DIR) && ln -fs $HOME/$CIRCLE_PROJECT_REPONAME $BASE_DIR:
            pwd: /
        - echo 'export GOPATH=$GOPATH:$HOME/.go_project' >> ~/.circlerc
        - sudo pip install --upgrade docker-compose==1.7.1

test:
    override:
        - make all
