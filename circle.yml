machine:
    pre:
        - sudo curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
        - sudo chmod 0755 /usr/bin/docker
    services:
        - docker

dependencies:
    override:
        - sudo pip install --upgrade docker-compose==1.7.1

test:
    override:
        - make

deployment:
    hub:
        branch: master
        owner: medigo
        commands:
            - docker tag -f medigo/laika:latest medigo/laika:$(CIRCLE_SHA1)
            - docker login -e $(DOCKER_EMAIL) -u $(DOCKER_USER) -p $(DOCKER_PASS)
            - docker push medigo/laika:latest
            - docker push medigo/laika:$(CIRCLE_SHA1)
